#!/bin/sh

# https://github.com/AlphaKeks

# background services
doas /bin/amdfan --daemon &
pgrep -x sxhkd > /dev/null || sxhkd &
/usr/lib/xfce-polkit/xfce-polkit &
/usr/bin/pipewire &
/bin/sleep 0.5s &&
/usr/bin/easyeffects --gapplication-service &
/usr/bin/unclutter &

bspc monitor DisplayPort-2 -d 1 2 3 4 5 6 7 8 9 # main
bspc monitor DisplayPort-3 -d discord signal mail 4 5 6 7 8 9 # left
bspc monitor DisplayPort-4 -d 1 2 3 4 5 6 7 8 9 # top
bspc monitor HDMI-A-2 -d 1 2 3 4 5 6 7 8 9 # right

# global config
bspc config border_width 0
bspc config window_gap 0
bspc config split_ratio 0.5
bspc config borderless_monocle false
bspc config focus_follows_pointer false
bspc config normal_border_color \#1e1e2e
bspc config active_border_color \#1e1e2e
bspc config focused_border_color \#7480c2
wmname "LG3D"

# floating rules
bspc rule -a Galculator state=floating
bspc rule -a Bitwarden state=floating
bspc rule -a Pavucontrol state=floating
bspc rule -a KeyOverlay state=floating
bspc rule -a Thunar state=floating
bspc rule -a Gthumb state=floating

# autostart rules
bspc rule -a discord monitor=DisplayPort-1 desktop=discord
bspc rule -a Signal monitor=DisplayPort-1 desktop=signal
bspc rule -a Geary monitor=DisplayPort-1 desktop=mail

# corners for floating windows
corners() {
	bspc subscribe node_state | while read -r _ _ _ node state status; do
		if [[ "$state" == "floating" ]]; then
			case "$status" in
				off) xprop -id "$node" -remove _PICOM_CORNERS;;
				on) xprop -id "$node" -f _PICOM_CORNERS 32c -set _PICOM_CORNERS 1;;
			esac
		fi
	done
}

/usr/bin/picom -b --experimental-backends --config $CFG/picom/picom.conf &
/usr/bin/dunst &
/usr/bin/screencloud &
/usr/bin/nitrogen --restore &
corners &
/usr/bin/xsetroot -cursor_name left_ptr &

$CFG/polybar/launch.sh &
/usr/bin/conky -c $CFG/conky/catppuccin.conf &
/usr/bin/signal-desktop &
/usr/bin/discord &
/usr/bin/geary &
/usr/bin/steam -silent &

rm -rf ~/tmp/*
